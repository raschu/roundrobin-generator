<!DOCTYPE html>
<html lang="de">
<head>
<title><%event%></title>
<meta charset="utf-8"/>
<style>
h2, h1 {
  font-family: monospace;
}
a {
  color: black;
}
#results {
  font-family: monospace;
  border-collapse: collapse;
  width: 600px;
}
#ranking {
  font-family: monospace;
  border-collapse: collapse;
  width: 300px;
}
#results td, #results th {
  border: 1px solid #ddd;
  padding: 2px;
}
#ranking td, #ranking th {
  border: 1px solid #ddd;
  padding: 2px;
}

tr.dark { 
  background: #f2f2f2;
}


#results th {
  padding-top: 2px;
  padding-bottom: 2px;
  text-align: left;
  background-color: #4CAF50;
  color: white;
}
#ranking th {
  padding-top: 2px;
  padding-bottom: 2px;
  text-align: left;
  background-color: #4CAF50;
  color: white;
}
</style>
</head>
<body>
<h1><%event%></h1>
<table>
<tr>
<td valign=top>
<h2>Resultate</h2>
<div id="id_table"></div>
</td>
<td valign=top>
<h2>Rangliste</h2>
<div id="id_ranking"></div>
</td>
</tr>
</table>
<script>

getResults();
getRanking();

window.setInterval(function(){
getResults();
}, 3000   );


function getResults() {
    var xmlhttp = new XMLHttpRequest();
    var url = "/results";

    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        var myArr = JSON.parse(this.responseText);
        calcTable(myArr);
      }
    };
    xmlhttp.open("GET", url, true);
    xmlhttp.send();
    getRanking();
}

function getRanking() {
    var xmlhttp = new XMLHttpRequest();
    var url = "/ranking";

    xmlhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        document.getElementById("id_ranking").innerHTML = this.responseText;
      }
    };
    xmlhttp.open("GET", url, true);
    xmlhttp.send();
}

 
function calcTable(arr) {
    var HTML = "<table id=\"results\"><tr><th>Runde</th><th>#</th><th>Weiss</th><th>Schwarz</th><th>Resultat</th></tr>"; 
    var i;
    var dark = 0;
    for(i = 0; i < arr.length; i++) {
        dark++;
        if (dark <= <%cntrows%>) {
            HTML +=  '<tr><td align=right>' + arr[i].game + '</td><td align=right><a href="' +arr[i].gameurl + '">' + arr[i].no + '</a></td><td>' + arr[i].white + '</td><td>' + arr[i].black + '</td><td>' + arr[i].result + '</td></tr>';
        } else {
            HTML +=  '<tr class=dark><td align=right>' + arr[i].game + '</td><td align=right><a href="' +arr[i].gameurl + '">' + arr[i].no + '</a></td><td>' + arr[i].white + '</td><td>' + arr[i].black + '</td><td>' + arr[i].result + '</td></tr>';
        }
        
        if (dark == <%cntrows%> * 2) {
            dark = 0;
        }
        
    }
    HTML += "</table>";
    document.getElementById("id_table").innerHTML = HTML;
}
</script>   
<table>
<tr>
<td valign=top>
</table>
    <%FOREACH item IN images %>
        <hr><a href="<%item%>"><img width=600 src="<%item%>"></a></br>
    <%END%>
</td>
</tr>    
</body>
